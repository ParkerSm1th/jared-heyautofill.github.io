/* NicEdit - Micro Inline WYSIWYG
 * Copyright 2007-2008 Brian Kirchoff
 *
 * NicEdit is distributed under the terms of the MIT license
 * For more information visit http://nicedit.com/
 * Do not remove this copyright message
 */
var bkExtend=function(){var a=arguments;if(a.length==1)a=[this,a[0]];for(var b in a[1])a[0][b]=a[1][b];return a[0]};function bkClass(){}bkClass.prototype.construct=function(){};bkClass.extend=function(c){var a=function(){if(arguments[0]!==bkClass)return this.construct.apply(this,arguments)},b=new this(bkClass);bkExtend(b,c);a.prototype=b;a.extend=this.extend;return a};var bkElement=bkClass.extend({construct:function(a,b){if(typeof a=="string")a=(b||document).createElement(a);a=$BK(a);return a},appendTo:function(a){a.appendChild(this);return this},appendBefore:function(a){a.parentNode.insertBefore(this,a);return this},addEvent:function(a,b){bkLib.addEvent(this,a,b);return this},setContent:function(a){this.innerHTML=a;return this},pos:function(){var a=this,b=curtop=0,d=obj=a;if(obj.offsetParent)do{b+=obj.offsetLeft;curtop+=obj.offsetTop}while(obj=obj.offsetParent);var c=!window.opera?parseInt(a.getStyle("border-width")||a.style.border)||0:0;return[b+c,curtop+c+a.offsetHeight]},noSelect:function(){bkLib.noSelect(this);return this},parentTag:function(b){var a=this;do{if(a&&a.nodeName&&a.nodeName.toUpperCase()==b)return a;a=a.parentNode}while(a);return false},hasClass:function(a){return this.className.match(new RegExp("(\\s|^)nicEdit-"+a+"(\\s|$)"))},addClass:function(a){if(!this.hasClass(a))this.className+=" nicEdit-"+a;return this},removeClass:function(b){var a=this;if(a.hasClass(b))a.className=a.className.replace(new RegExp("(\\s|^)nicEdit-"+b+"(\\s|$)")," ");return a},setStyle:function(b){var c=this.style;for(var a in b)switch(a){case"float":c.cssFloat=c.styleFloat=b[a];break;case"opacity":c.opacity=b[a];c.filter="alpha(opacity="+Math.round(b[a]*100)+")";break;case"className":this.className=b[a];break;default:c[a]=b[a]}return this},getStyle:function(b,c){var a=!c?document.defaultView:c;if(this.nodeType==1)return a&&a.getComputedStyle?a.getComputedStyle(this,null).getPropertyValue(b):this.currentStyle[bkLib.camelize(b)]},remove:function(){this.parentNode.removeChild(this);return this},setAttributes:function(b){for(var a in b)this[a]=b[a];return this}}),bkLib={isMSIE:navigator.appVersion.indexOf("MSIE")!=-1,addEvent:function(a,b,c){a.addEventListener?a.addEventListener(b,c,false):a.attachEvent("on"+b,c)},toArray:function(b){var a=b.length,c=new Array(a);while(a--)c[a]=b[a];return c},noSelect:function(a){a.setAttribute&&a.nodeName.toLowerCase()!="input"&&a.nodeName.toLowerCase()!="textarea"&&a.setAttribute("unselectable","on");for(var b=0;b<a.childNodes.length;b++)bkLib.noSelect(a.childNodes[b])},camelize:function(a){return a.replace(/\-(.)/g,function(b,a){return a.toUpperCase()})},inArray:function(b,a){return bkLib.search(b,a)!=null},search:function(b,c){for(var a=0;a<b.length;a++)if(b[a]==c)return a;return null},cancelEvent:function(a){a=a||window.event;if(a.preventDefault&&a.stopPropagation){a.preventDefault();a.stopPropagation()}return false},domLoad:[],domLoaded:function(){if(arguments.callee.done)return;arguments.callee.done=true;for(i=0;i<bkLib.domLoad.length;i++)bkLib.domLoad[i]()},onDomLoaded:function(a){this.domLoad.push(a);if(document.addEventListener)document.addEventListener("DOMContentLoaded",bkLib.domLoaded,null);else if(bkLib.isMSIE){document.write("<style>.nicEdit-main p { margin: 0; }</style><script id=__ie_onload defer "+(location.protocol=="https:"?"src='javascript:void(0)'":"src=//0")+"><\/script>");$BK("__ie_onload").onreadystatechange=function(){this.readyState=="complete"&&bkLib.domLoaded()}}window.onload=bkLib.domLoaded}};function $BK(a){if(typeof a=="string")a=document.getElementById(a);return a&&!a.appendTo?bkExtend(a,bkElement.prototype):a}var bkEvent={addEvent:function(b,c){var a=this;if(c){a.eventList=a.eventList||{};a.eventList[b]=a.eventList[b]||[];a.eventList[b].push(c)}return a},fireEvent:function(){var a=this,d=bkLib.toArray(arguments),b=d.shift();if(a.eventList&&a.eventList[b])for(var c=0;c<a.eventList[b].length;c++)a.eventList[b][c].apply(a,d)}};function __(a){return a}Function.prototype.closure=function(){var b=this,a=bkLib.toArray(arguments),c=a.shift();return function(){if(typeof bkLib!="undefined")return b.apply(c,a.concat(bkLib.toArray(arguments)))}};Function.prototype.closureListener=function(){var b=this,a=bkLib.toArray(arguments),c=a.shift();return function(d){d=d||window.event;if(d.target)var e=d.target;else var e=d.srcElement;return b.apply(c,[d,e].concat(a))}};var nicEditorConfig=bkClass.extend({buttons:{bold:{name:__("Click to Bold"),command:"Bold",tags:["B","STRONG"],css:{"font-weight":"bold"},key:"b"},italic:{name:__("Click to Italic"),command:"Italic",tags:["EM","I"],css:{"font-style":"italic"},key:"i"},underline:{name:__("Click to Underline"),command:"Underline",tags:["U"],css:{"text-decoration":"underline"},key:"u"},left:{name:__("Left Align"),command:"justifyleft",noActive:true},center:{name:__("Center Align"),command:"justifycenter",noActive:true},right:{name:__("Right Align"),command:"justifyright",noActive:true},justify:{name:__("Justify Align"),command:"justifyfull",noActive:true},ol:{name:__("Insert Ordered List"),command:"insertorderedlist",tags:["OL"]},ul:{name:__("Insert Unordered List"),command:"insertunorderedlist",tags:["UL"]},subscript:{name:__("Click to Subscript"),command:"subscript",tags:["SUB"]},superscript:{name:__("Click to Superscript"),command:"superscript",tags:["SUP"]},strikethrough:{name:__("Click to Strike Through"),command:"strikeThrough",css:{"text-decoration":"line-through"}},removeformat:{name:__("Remove Formatting"),command:"removeformat",noActive:true},indent:{name:__("Indent Text"),command:"indent",noActive:true},outdent:{name:__("Remove Indent"),command:"outdent",noActive:true},hr:{name:__("Horizontal Rule"),command:"insertHorizontalRule",noActive:true}},iconsPath:"nicedit/nicEditorIcons.gif",buttonList:["save","bold","italic","underline","left","center","right","justify","ol","ul","fontSize","fontFamily","fontFormat","indent","outdent","image","upload","link","unlink","forecolor","bgcolor"],iconList:{bold:1,center:2,hr:3,indent:4,italic:5,justify:6,left:7,ol:8,outdent:9,removeformat:10,right:11,save:12,strikethrough:13,subscript:14,superscript:15,ul:16,underline:17}}),nicEditors={nicPlugins:[],editors:[],registerPlugin:function(b,a){this.nicPlugins.push({p:b,o:a})},allTextAreas:function(c){for(var b=document.getElementsByTagName("textarea"),a=0;a<b.length;a++)nicEditors.editors.push(new nicEditor(c).panelInstance(b[a]));return nicEditors.editors},findEditor:function(c){for(var b=nicEditors.editors,a=0;a<b.length;a++)if(b[a].instanceById(c))return b[a].instanceById(c)}},nicEditor=bkClass.extend({construct:function(d){var a=this;a.options=new nicEditorConfig;bkExtend(a.options,d);a.nicInstances=[];a.loadedPlugins=[];for(var c=nicEditors.nicPlugins,b=0;b<c.length;b++)a.loadedPlugins.push(new c[b].p(a,c[b].o));nicEditors.editors.push(a);bkLib.addEvent(document.body,"mousedown",a.selectCheck.closureListener(a))},panelInstance:function(a,c){a=this.checkReplace($BK(a));var b=new bkElement("DIV").setStyle({width:(parseInt(a.getStyle("width"))||a.clientWidth)+"px"}).appendBefore(a);this.setPanel(b);return this.addInstance(a,c)},checkReplace:function(a){var b=nicEditors.findEditor(a);if(b){b.removeInstance(a);b.removePanel()}return a},addInstance:function(b,c){var a=this;b=a.checkReplace($BK(b));if(b.contentEditable||!!window.opera)var d=new nicEditorInstance(b,c,a);else var d=new nicEditorIFrameInstance(b,c,a);a.nicInstances.push(d);return a},removeInstance:function(c){c=$BK(c);for(var b=this.nicInstances,a=0;a<b.length;a++)if(b[a].e==c){b[a].remove();this.nicInstances.splice(a,1)}},removePanel:function(){if(this.nicPanel){this.nicPanel.remove();this.nicPanel=null}},instanceById:function(c){c=$BK(c);for(var b=this.nicInstances,a=0;a<b.length;a++)if(b[a].e==c)return b[a]},setPanel:function(b){var a=this;a.nicPanel=new nicEditorPanel($BK(b),a.options,a);a.fireEvent("panel",a.nicPanel);return a},nicCommand:function(b,a){this.selectedInstance&&this.selectedInstance.nicCommand(b,a)},getIcon:function(b,c){var a=this.options.iconList[b],d=c.iconFiles?c.iconFiles[b]:"";return{backgroundImage:"url('"+(a?this.options.iconsPath:d)+"')",backgroundPosition:(a?(a-1)*-18:0)+"px 0px"}},selectCheck:function(d,b){var a=this,c=false;do if(b.className&&b.className.indexOf("nicEdit")!=-1)return false;while(b=b.parentNode);a.fireEvent("blur",a.selectedInstance,b);a.lastSelectedInstance=a.selectedInstance;a.selectedInstance=null;return false}});nicEditor=nicEditor.extend(bkEvent);var nicEditorInstance=bkClass.extend({isSelected:false,construct:function(b,j,i){var c="px",a=this;a.ne=i;a.elm=a.e=b;a.options=j||{};newX=parseInt(b.getStyle("width"))||b.clientWidth;newY=parseInt(b.getStyle("height"))||b.clientHeight;a.initialHeight=newY-8;var e=b.nodeName.toLowerCase()=="textarea";if(e||a.options.hasPanel){var f=bkLib.isMSIE&&!(typeof document.body.style.maxHeight!="undefined"&&document.compatMode=="CSS1Compat"),h={width:newX+c,border:"1px solid #ccc",borderTop:0,overflowY:"auto",overflowX:"hidden"};h[f?"height":"maxHeight"]=a.ne.options.maxHeight?a.ne.options.maxHeight+c:null;a.editorContain=new bkElement("DIV").setStyle(h).appendBefore(b);var d=new bkElement("DIV").setStyle({width:newX-8+c,margin:"4px",minHeight:newY+c}).addClass("main").appendTo(a.editorContain);b.setStyle({display:"none"});d.innerHTML=b.innerHTML;if(e){d.setContent(b.value);a.copyElm=b;var g=b.parentTag("FORM");g&&bkLib.addEvent(g,"submit",a.saveContent.closure(a))}d.setStyle(f?{height:newY+c}:{overflow:"hidden"});a.elm=d}a.ne.addEvent("blur",a.blur.closure(a));a.init();a.blur()},init:function(){var a=this;a.elm.setAttribute("contentEditable","true");a.getContent()==""&&a.setContent("<br />");a.instanceDoc=document.defaultView;a.elm.addEvent("mousedown",a.selected.closureListener(a)).addEvent("keypress",a.keyDown.closureListener(a)).addEvent("focus",a.selected.closure(a)).addEvent("blur",a.blur.closure(a)).addEvent("keyup",a.selected.closure(a));a.ne.fireEvent("add",a)},remove:function(){var a=this;a.saveContent();if(a.copyElm||a.options.hasPanel){a.editorContain.remove();a.e.setStyle({display:"block"});a.ne.removePanel()}a.disable();a.ne.fireEvent("remove",a)},disable:function(){this.elm.setAttribute("contentEditable","false")},getSel:function(){return window.getSelection?window.getSelection():document.selection},getRng:function(){var a=this.getSel();return!a?null:a.rangeCount>0?a.getRangeAt(0):null},selRng:function(a,b){if(window.getSelection){b.removeAllRanges();b.addRange(a)}else a.select()},selElm:function(){var a=this.getRng();if(a){var b=a.startContainer;if(a.cloneContents().childNodes.length==1)for(var c=0;c<b.childNodes.length;c++){var d=b.childNodes[c].ownerDocument.createRange();d.selectNode(b.childNodes[c]);if(a.compareBoundaryPoints(Range.START_TO_START,d)!=1&&a.compareBoundaryPoints(Range.END_TO_END,d)!=-1)return $BK(b.childNodes[c])}return $BK(b)}else return $BK(this.getSel().type=="Control"?a.item(0):null)},saveRng:function(){var a=this;a.savedRange=a.getRng();a.savedSel=a.getSel()},restoreRng:function(){var a=this;a.savedRange&&a.selRng(a.savedRange,a.savedSel)},keyDown:function(a){a.ctrlKey&&this.ne.fireEvent("key",this,a)},selected:function(e,c){var d="selected",a=this;if(!c)c=a.selElm();if(!e.ctrlKey){var b=a.ne.selectedInstance;if(b!=a){b&&a.ne.fireEvent("blur",b,c);a.ne.selectedInstance=a;a.ne.fireEvent("focus",b,c)}a.ne.fireEvent(d,b,c);a.isFocused=true;a.elm.addClass(d)}return false},blur:function(){this.isFocused=false;this.elm.removeClass("selected")},saveContent:function(){var a=this;if(a.copyElm||a.options.hasPanel){a.ne.fireEvent("save",a);a.copyElm?a.copyElm.value=a.getContent():a.e.innerHTML=a.getContent()}},getElm:function(){return this.elm},getContent:function(){var a=this;a.content=a.getElm().innerHTML;a.ne.fireEvent("get",a);return a.content},setContent:function(b){var a=this;a.content=b;a.ne.fireEvent("set",a);a.elm.innerHTML=a.content},nicCommand:function(b,a){document.execCommand(b,false,a)}}),nicEditorIFrameInstance=nicEditorInstance.extend({savedStyles:[],init:function(){var a=this,b=a.elm.innerHTML.replace(/^\s+|\s+$/g,"");a.elm.innerHTML="";!b?b="<br />":b;a.initialContent=b;a.elmFrame=new bkElement("iframe").setAttributes({src:"javascript:;",frameBorder:0,allowTransparency:"true",scrolling:"no"}).setStyle({height:"100px",width:"100%"}).addClass("frame").appendTo(a.elm);a.copyElm&&a.elmFrame.setStyle({width:a.elm.offsetWidth-4+"px"});var c=["font-size","font-family","font-weight","color"];for(itm in c)a.savedStyles[bkLib.camelize(itm)]=a.elm.getStyle(itm);setTimeout(a.initFrame.closure(a),50)},disable:function(){this.elm.innerHTML=this.getContent()},initFrame:function(){var a=this,b=$BK(a.elmFrame.contentWindow.document);b.designMode="on";b.open();var c=a.ne.options.externalCSS;b.write("<html><head>"+(c?'<link href="'+c+'" rel="stylesheet" type="text/css" />':"")+'</head><body id="nicEditContent" style="margin: 0 !important; background-color: transparent !important;">'+a.initialContent+"</body></html>");b.close();a.frameDoc=b;a.frameWin=$BK(a.elmFrame.contentWindow);a.frameContent=$BK(a.frameWin.document.body).setStyle(a.savedStyles);a.instanceDoc=a.frameWin.document.defaultView;a.heightUpdate();a.frameDoc.addEvent("mousedown",a.selected.closureListener(a)).addEvent("keyup",a.heightUpdate.closureListener(a)).addEvent("keydown",a.keyDown.closureListener(a)).addEvent("keyup",a.selected.closure(a));a.ne.fireEvent("add",a)},getElm:function(){return this.frameContent},setContent:function(b){var a=this;a.content=b;a.ne.fireEvent("set",a);a.frameContent.innerHTML=a.content;a.heightUpdate()},getSel:function(){return this.frameWin?this.frameWin.getSelection():this.frameDoc.selection},heightUpdate:function(){this.elmFrame.style.height=Math.max(this.frameContent.offsetHeight,this.initialHeight)+"px"},nicCommand:function(b,a){this.frameDoc.execCommand(b,false,a);setTimeout(this.heightUpdate.closure(this),100)}}),nicEditorPanel=bkClass.extend({construct:function(b,f,d){var a=this;a.elm=b;a.options=f;a.ne=d;a.panelButtons=[];a.buttonList=bkExtend([],a.ne.options.buttonList);a.panelContain=new bkElement("DIV").setStyle({overflow:"hidden",width:"100%",border:"1px solid #cccccc",backgroundColor:"#efefef"}).addClass("panelContain");a.panelElm=new bkElement("DIV").setStyle({margin:"2px",marginTop:"0px",zoom:1,overflow:"hidden"}).addClass("panel").appendTo(a.panelContain);a.panelContain.appendTo(b);var c=a.ne.options,e=c.buttons;for(button in e)a.addButton(button,c,true);a.reorder();b.noSelect()},addButton:function(buttonName,options,noOrder){var a=this,button=options.buttons[buttonName],type=button.type?eval("(typeof("+button.type+') == "undefined") ? null : '+button.type+";"):nicEditorButton,hasButton=bkLib.inArray(a.buttonList,buttonName);if(type&&(hasButton||a.ne.options.fullPanel)){a.panelButtons.push(new type(a.panelElm,buttonName,options,a.ne));!hasButton&&a.buttonList.push(buttonName)}},findButton:function(b){for(var a=0;a<this.panelButtons.length;a++)if(this.panelButtons[a].name==b)return this.panelButtons[a]},reorder:function(){for(var c=this.buttonList,a=0;a<c.length;a++){var b=this.findButton(c[a]);b&&this.panelElm.appendChild(b.margin)}},remove:function(){this.elm.remove()}}),nicEditorButton=bkClass.extend({construct:function(f,c,e,d){var b="DIV",a=this;a.options=e.buttons[c];a.name=c;a.ne=d;a.elm=f;a.margin=new bkElement(b).setStyle({"float":"left",marginTop:"2px"}).appendTo(f);a.contain=new bkElement(b).setStyle({width:"20px",height:"20px"}).addClass("buttonContain").appendTo(a.margin);a.border=new bkElement(b).setStyle({backgroundColor:"#efefef",border:"1px solid #efefef"}).appendTo(a.contain);a.button=new bkElement(b).setStyle({width:"18px",height:"18px",overflow:"hidden",zoom:1,cursor:"pointer"}).addClass("button").setStyle(a.ne.getIcon(c,e)).appendTo(a.border);a.button.addEvent("mouseover",a.hoverOn.closure(a)).addEvent("mouseout",a.hoverOff.closure(a)).addEvent("mousedown",a.mouseClick.closure(a)).noSelect();if(!window.opera)a.button.onmousedown=a.button.onclick=bkLib.cancelEvent;d.addEvent("selected",a.enable.closure(a)).addEvent("blur",a.disable.closure(a)).addEvent("key",a.key.closure(a));a.disable();a.init()},init:function(){},hide:function(){this.contain.setStyle({display:"none"})},updateState:function(){var a=this;if(a.isDisabled)a.setBg();else if(a.isHover)a.setBg("hover");else if(a.isActive)a.setBg("active");else a.setBg()},setBg:function(b){var a="1px solid #666";switch(b){case"hover":var c={border:a,backgroundColor:"#ddd"};break;case"active":var c={border:a,backgroundColor:"#ccc"};break;default:var c={border:"1px solid #efefef",backgroundColor:"#efefef"}}this.border.setStyle(c).addClass("button-"+b)},checkNodes:function(c){var b=this,a=c;do if(b.options.tags&&a&&bkLib.inArray(b.options.tags,a.nodeName)){b.activate();return true}while(a&&(a=a.parentNode)&&a.className!="nicEdit");a=$BK(c);while(a&&a.nodeType==3)a=$BK(a.parentNode);if(b.options.css)for(itm in b.options.css)if(a&&a.getStyle(itm,b.ne.selectedInstance.instanceDoc)==b.options.css[itm]){b.activate();return true}b.deactivate();return false},activate:function(){var a=this;if(!a.isDisabled){a.isActive=true;a.updateState();a.ne.fireEvent("buttonActivate",a)}},deactivate:function(){var a=this;a.isActive=false;a.updateState();!a.isDisabled&&a.ne.fireEvent("buttonDeactivate",a)},enable:function(c,b){var a=this;a.isDisabled=false;a.contain.setStyle({opacity:1}).addClass("buttonEnabled");a.updateState();a.checkNodes(b)},disable:function(){this.isDisabled=true;this.contain.setStyle({opacity:.6}).removeClass("buttonEnabled");this.updateState()},toggleActive:function(){this.isActive?this.deactivate():this.activate()},hoverOn:function(){var a=this;if(!a.isDisabled){a.isHover=true;a.updateState();a.ne.fireEvent("buttonOver",a)}},hoverOff:function(){var a=this;a.isHover=false;a.updateState();a.ne.fireEvent("buttonOut",a)},mouseClick:function(){var a=this;if(a.options.command){a.ne.nicCommand(a.options.command,a.options.commandArgs);!a.options.noActive&&a.toggleActive()}a.ne.fireEvent("buttonClick",a)},key:function(b,a){if(this.options.key&&a.ctrlKey&&String.fromCharCode(a.keyCode||a.charCode).toLowerCase()==this.options.key){this.mouseClick();a.preventDefault&&a.preventDefault()}}}),nicPlugin=bkClass.extend({construct:function(b,c){var a=this;a.options=c;a.ne=b;a.ne.addEvent("panel",a.loadPanel.closure(a));a.init()},loadPanel:function(a){var b=this.options.buttons;for(var c in b)a.addButton(c,this.options);a.reorder()},init:function(){}});
